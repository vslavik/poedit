name: poedit
version: '0.0.0-git'
summary: Gettext translations editor for OS X, Windows and Unix.
description: |
  This program is a GUI frontend to GNU Gettext utilities and a catalogs
  editor/source code parser. It helps with translating applications into
  other languages.

  By default Poedit can only open files under your home directory, to
  allow Poedit access files under /media run the following command in
  terminal as superuser:

    # snap connect poedit:removable-media

grade: devel
confinement: devmode
icon: ../artwork/linux/appicon/512x512/apps/poedit.png

parts:
  poedit:
    plugin: autotools
    configflags:
      - --with-wx-prefix=$SNAPCRAFT_PART_INSTALL/../../wxwidgets/install
      - --with-boost=$SNAPCRAFT_PART_INSTALL/../../boostlib/install
    install-via: prefix
    source: ..
    build-packages:
      # FIXME: Extracted from Debian package, might be more than enough
      - asciidoc
      - gettext
      # Boost libraries provided by Ubuntu 16.04 are too old
      #- libboost-dev
      #- libboost-iostreams-dev
      #- libboost-regex-dev
      #- libboost-system-dev
      #- libboost-thread-dev
      - libcld2-dev
      - libcpprest-dev
      - libdb++-dev
      #- libgtk2.0-dev
      - libgtkspell-dev
      - libicu-dev
      - liblucene++-dev
      - libsecret-1-dev
      # wxWidgets library provided by Ubuntu 16.04 is too old
      #- libwxgtk3.0-dev
      #- nlohmann-json-dev
      - xsltproc
      - xmlto
      - zip
    override-build: |
      ./bootstrap
      snapcraftctl build
    stage-packages:
      - gettext
    filesets:
      executables:
        - usr/local/bin/*
      freedesktop-desktop-entries:
        - usr/local/share/applications/*
      icons:
        - usr/local/share/icons/*
      localizations:
        - usr/local/share/locale/*
      manpages:
        - usr/local/share/man/*
      pixmaps:
        - usr/local/share/pixmaps/*
      resources:
        - usr/local/share/poedit/*
    stage:
      - $executables
      - $freedesktop-desktop-entries
      - $manpages
      - $localizations
      - $pixmaps
      - $resources
    prime:
      - $executables
      - $freedesktop-desktop-entries
      - $manpages
      - $localizations
      - $pixmaps
      - $resources
    after:
      - boostlib
      - desktop-gtk3
      - wxwidgets
  boostlib:
    plugin: dump
    source: ../deps/boost
    build-packages:
      # FIXME: Extracted from debian package, might be more than enough
      - bison
      - dctrl-tools
      - docbook-to-man
      - flex
      - g++
      # - g++-6
      - help2man
      - libbz2-dev
      - libicu-dev
      - mpi-default-dev
      - python
      - python-all-dev
      - python3
      - python3-all-dev
      - xsltproc
      - zlib1g-dev
    override-build: |
      ./bootstrap.sh
      ./b2 install\
        --prefix=../install\
        -j $(nproc)\
        --build-type=minimal\
        --layout=system\
        --with-iostreams\
        --with-regex\
        --with-system\
        --with-thread\
        threading=multi\
        link=static
    filesets:
      headers:
        - include/*
      static-libs:
        - lib/*.a
    stage:
      - -*
  wxwidgets:
    plugin: autotools
    configflags:
      - --disable-gui
      - --disable-shared
      - --disable-sound
      - --enable-display
      - --enable-geometry
      - --enable-graphics_ctx
      - --enable-mediactrl
      - --enable-unicode
      - --enable-xrc
      - --with-gtk=3
      - --without-opengl
      - --without-sdl
    install-via: prefix
    source: ../deps/wx
    build-packages:
      # FIXME: Extracted from debian package, might be more than enough
      - autoconf
      - autotools-dev
      - g++
      - gettext
      - libexpat1-dev
      - libgtk-3-dev
      - libjpeg-dev
      - libnotify-dev
      - libpng-dev
      - libsm-dev
      - libtiff5-dev
      - libxt-dev
      - zlib1g-dev
      # FIXME: Probably not used by Poedit and can be dropped
      #- libgl1-mesa-dev
      #- libglu1-mesa-dev
      #- libgstreamer1.0-dev
      #- libgstreamer-plugins-base1.0-dev
      #- libwebkit2gtk-4.0-dev
    filesets:
      headers:
        - include/*
      static-libs:
        - lib/*.a
    stage:
      - -*

apps:
  poedit:
    command: usr/local/bin/poedit
    plugs:
      - desktop
      - desktop-legacy
      - home
      - network
      - removable-media
      - x11
    desktop: usr/local/share/applications/poedit.desktop
